<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã„ãã‚‚ã®ã‚³ãƒã‚¯ãƒˆï¼†ã•ãŒã—</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=M+PLUS+Rounded+1c:wght@700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'M PLUS Rounded 1c', 'Inter', sans-serif;
            touch-action: manipulation; /* ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ ã‚’ç„¡åŠ¹åŒ– */
        }

        /* --- å…±é€šã‚¹ã‚¿ã‚¤ãƒ« --- */
        .screen {
            display: none;
            width: 100%;
            min-height: 100vh;
            padding: 20px;
        }
        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .game-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }
        @media (min-width: 640px) {
            .game-title { font-size: 3.5rem; }
        }
        .game-subtitle {
            font-size: 1.1rem;
            color: #4b5563; /* gray-600 */
            margin-bottom: 2rem;
        }
        @media (min-width: 640px) {
            .game-subtitle { font-size: 1.25rem; }
        }
        .game-button {
            width: 100%;
            color: white;
            font-weight: 700;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem; /* 12px */
            font-size: 1.25rem; /* 20px */
            transition: all 0.2s;
            transform: scale(1);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .game-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        /* --- ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º (3ã‚«ãƒ©ãƒ ) --- */
        #ranking-section .rank-column h4 {
            font-size: 1.1rem; /* ã‹ã‚“ãŸã‚“/ãµã¤ã†/ã‚€ãšã‹ã—ã„ ã®æ–‡å­—ã‚µã‚¤ã‚º */
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 3px solid;
        }
        #ranking-section ol {
            list-style-type: decimal;
            list-style-position: inside;
            text-align: left;
            height: 12rem; /* 192px */
            overflow-y: auto;
            background-color: #f9fafb; /* gray-50 */
            padding: 0.75rem; /* 12px */
            border-radius: 0.5rem; /* 8px */
            border: 1px solid #e5e7eb; /* gray-200 */
        }
        #ranking-section li {
            font-size: 0.9rem; /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®æ–‡å­—ã‚µã‚¤ã‚º */
            padding: 0.1rem 0.25rem;
            border-radius: 4px;
        }
        @media (min-width: 640px) {
             #ranking-section li {
                font-size: 1rem; /* 16px */
             }
        }
        #ranking-section li:nth-child(odd) {
            background-color: #ffffff; /* white */
        }
        #ranking-section li .rank-name {
            font-weight: 700;
            color: #1f2937; /* gray-800 */
            display: inline-block;
            max-width: 60%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            vertical-align: bottom;
        }
        #ranking-section li .rank-time {
            float: right;
            font-weight: 700;
            color: #1d4ed8; /* blue-700 */
        }
        /* 1ä½ */
        #ranking-section li:nth-child(1) { 
            background-color: #fef9c3; /* yellow-100 */
        }
        #ranking-section li:nth-child(1) .rank-name {
            color: #ca8a04; /* yellow-600 */
        }

        /* --- ã‚³ãƒã‚¯ãƒˆã‚²ãƒ¼ãƒ ï¼ˆç¥çµŒè¡°å¼±ï¼‰ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .card {
            width: 100%;
            aspect-ratio: 1 / 1;
            perspective: 1000px;
            cursor: pointer;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card.is-flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .card-back {
            background-color: #4ade80; /* green-400 */
            color: white;
            font-size: 3rem;
        }
        .card-front {
            background-color: #f0fdf4; /* green-50 */
            color: #166534; /* green-800 */
            font-size: 2.5rem;
            transform: rotateY(180deg);
            padding: 8px;
            line-height: 1;
        }
        .card.is-matched {
            opacity: 0.3;
            pointer-events: none;
        }
        /* ãƒ’ãƒ³ãƒˆç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .card.is-hinting .card-back {
            animation: hint-blink 0.5s 3;
        }
        @keyframes hint-blink {
            50% {
                transform: scale(1.1);
                background-color: #fde047; /* yellow-400 */
            }
        }

        /* ã‚°ãƒªãƒƒãƒ‰ */
        .grid-tutorial { grid-template-columns: repeat(2, 1fr); max-width: 200px; }
        .grid-easy { grid-template-columns: repeat(4, 1fr); }
        .grid-medium { grid-template-columns: repeat(4, 1fr); }
        .grid-hard { grid-template-columns: repeat(5, 1fr); }
        @media (max-width: 640px) {
            .card-back { font-size: 2rem; }
            .card-front { font-size: 1.8rem; }
            .grid-tutorial { max-width: 150px; }
            .grid-easy { grid-template-columns: repeat(3, 1fr); }
            .grid-medium { grid-template-columns: repeat(4, 1fr); }
            .grid-hard { grid-template-columns: repeat(4, 1fr); }
        }

        /* --- ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€š --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none; /* JSã§åˆ¶å¾¡ */
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 20px;
        }
        /* ç°¡æ˜“ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã›ã„ã‹ã„/ã–ã‚“ã­ã‚“ï¼‰ */
        #simple-modal-content {
            padding: 30px 40px;
            border-radius: 16px;
            color: white;
            font-size: 2.5rem;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
        }
        #simple-modal-content.success {
            background: linear-gradient(135deg, #68d391, #38a169); /* green */
        }
        #simple-modal-content.error {
            background: linear-gradient(135deg, #fc8181, #e53e3e); /* red */
        }
        /* è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #explanation-modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        #explanation-text {
            font-size: 1.25rem;
            color: #1f2937;
            margin-bottom: 24px;
            line-height: 1.6;
        }
        /* ãƒ©ãƒ³ã‚¯ã‚¤ãƒ³å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #ranking-modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        /* â˜… ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */
        #confirm-modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        /* â˜… ã‚¨ãƒ©ãƒ¼å…¥åŠ› (ã‚·ã‚§ã‚¤ã‚¯) */
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
          20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .is-invalid {
            animation: shake 0.5s ease-in-out;
            border: 2px solid #e53e3e; /* red-600 */
        }


        /* --- ã„ãã‚‚ã®ã•ãŒã—ã‚²ãƒ¼ãƒ  ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #find-game-area {
            width: 100%;
            max-width: 800px;
            height: 65vh;
            border-radius: 12px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            border: 4px solid #86efac; /* green-300 */
        }
        #find-game-svg {
            width: 100%;
            height: 100%;
        }
        .target-animal {
            cursor: pointer;
            transition: opacity 0.3s ease, transform 0.2s ease;
            opacity: 0.9; /* å°‘ã—ã ã‘é€æ˜ã«ã—ã¦æ¢ã—ã«ãã */
        }
        .target-animal:hover {
            opacity: 1;
            transform: scale(1.2);
            stroke: #fef08a; /* yellow-200 */
            stroke-width: 2px;
        }
        .target-animal.is-found {
            opacity: 0.3;
            pointer-events: none;
        }
        #find-game-targets {
            display: flex;
            flex-direction: column; /* ç¸¦ä¸¦ã³ã«å¤‰æ›´ */
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 20px;
            padding: 12px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            max-width: 800px;
            width: 100%;
            position: relative; /* â˜… ãŠã‚ã‚‹ãƒœã‚¿ãƒ³é…ç½®ã®ãŸã‚ */
        }
        .target-item {
            font-size: 1.1rem;
            font-weight: 700;
            color: #6b7280; /* gray-500 */
            transition: all 0.3s;
        }
        .target-item.is-found {
            color: #10b981; /* green-500 */
            text-decoration: line-through;
        }
        /* è§£èª¬ã‚¨ãƒªã‚¢ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .explanation-list {
            text-align: left;
            background: #f9fafb; /* gray-50 */
            padding: 1rem 1.5rem;
            border-radius: 0.5rem; /* 8px */
            max-height: 16rem; /* 256px */
            overflow-y: auto;
            margin-bottom: 2rem;
            border: 1px solid #e5e7eb; /* gray-200 */
        }
        .explanation-list h3 {
            font-size: 1.5rem; /* 24px */
            font-weight: 700;
            color: #166534; /* green-800 */
            margin-bottom: 1rem;
        }
        .explanation-list div {
            font-size: 1.1rem; /* 18px */
        }

        /* --- â˜… è¨­å®šç”»é¢ --- */
        #settings-screen .setting-item {
            width: 100%;
            max-width: 400px;
            margin-bottom: 1.5rem; /* 24px */
        }
        #settings-screen label {
            display: block;
            font-size: 1.1rem; /* 18px */
            font-weight: 700;
            margin-bottom: 0.5rem; /* 8px */
            color: #374151; /* gray-700 */
        }
        #settings-screen input[type="range"] {
            width: 100%;
            cursor: pointer;
        }
        #settings-screen select {
            width: 100%;
            padding: 0.75rem; /* 12px */
            font-size: 1.1rem; /* 18px */
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem; /* 8px */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app">

        <!-- 0. ã‚²ãƒ¼ãƒ é¸æŠç”»é¢ -->
        <div id="game-select-screen" class="screen active">
            <div class="text-center p-6 bg-white rounded-2xl shadow-xl max-w-lg w-full">
                <h1 class="game-title text-green-700">ã„ãã‚‚ã® ãƒ¯ãƒ¼ãƒ«ãƒ‰</h1>
                <p class="game-subtitle">ã©ã¡ã‚‰ã®ã‚²ãƒ¼ãƒ ã§ã‚ãã¶ï¼Ÿ</p>
                
                <div class="space-y-4">
                    <button id="select-connect-game" class="game-button bg-blue-500 hover:bg-blue-600">
                        ğŸ¤ ã„ãã‚‚ã®ã‚³ãƒã‚¯ãƒˆï¼
                    </button>
                    <button id="select-find-game" class="game-button bg-yellow-500 hover:bg-yellow-600">
                        ğŸ‘€ ã„ãã‚‚ã® ã‹ãã‚Œã‚“ã¼
                    </button>
                    <!-- â˜… è¨­å®šãƒœã‚¿ãƒ³ -->
                    <button id="settings-button" class="game-button bg-gray-500 hover:bg-gray-600">
                        âš™ï¸ ã›ã£ã¦ã„
                    </button>
                </div>
            </div>
        </div>

        <!-- â˜… è¨­å®šç”»é¢ (æ–°è¦è¿½åŠ ) -->
        <div id="settings-screen" class="screen">
            <div class="text-center p-6 bg-white rounded-2xl shadow-xl max-w-lg w-full">
                <h1 class="game-title text-gray-700">âš™ï¸ ã›ã£ã¦ã„</h1>
                
                <!-- éŸ³é‡ -->
                <div class="setting-item">
                    <label for="volume-slider">ãŠã‚“ã‚Šã‚‡ã† (BGM)</label>
                    <div class="flex items-center space-x-2">
                        <span class="text-xl">ğŸ”ˆ</span>
                        <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5">
                        <span class="text-xl">ğŸ”Š</span>
                    </div>
                </div>

                <!-- BGMé¸æŠ -->
                <div class="setting-item">
                    <label for="bgm-select">BGM ã‚’ ãˆã‚‰ã¶</label>
                    <select id="bgm-select">
                        <option value="music.mp3">ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ 1</option>
                        <option value="music2.mp3">ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ 2</option>
                        <option value="music3.mp3">ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ 3</option> <!-- â˜… è¿½åŠ  -->
                    </select>
                </div>

                <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚»ãƒƒãƒˆ -->
                <div class="setting-item mt-8">
                    <label>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚»ãƒƒãƒˆ</label>
                    <button id="reset-ranking-btn" class="game-button bg-red-600 hover:bg-red-700">
                        ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ ãœã‚“ã¶ ã‘ã™
                    </button>
                </div>

                <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
                <button id="settings-back-button" class="game-button bg-gray-400 hover:bg-gray-500 mt-12">
                    ã‚‚ã©ã‚‹
                </button>
            </div>
        </div>

        <!-- 1. ã‚³ãƒã‚¯ãƒˆã‚²ãƒ¼ãƒ  ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div id="connect-start-screen" class="screen">
            <div class="text-center p-6 bg-white rounded-2xl shadow-xl max-w-3xl w-full">
                <h1 class="game-title text-blue-600">ã„ãã‚‚ã®ã‚³ãƒã‚¯ãƒˆï¼</h1>
                <p class="game-subtitle">ã¿ã¢ã‹ãª ãªã‹ã¾ã‚’ ã¿ã¤ã‘ã‚ˆã†</p>

                <!-- â˜…â˜…â˜… 3ã‚«ãƒ©ãƒ  ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºã‚¨ãƒªã‚¢ â˜…â˜…â˜… -->
                <div id="ranking-section" class="w-full mb-6">
                    <h3 class="text-2xl font-bold text-gray-700 mb-4">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚° ğŸ†</h3>
                    <div class="flex flex-col sm:flex-row justify-between space-y-4 sm:space-y-0 sm:space-x-4">
                        
                        <!-- ã‹ã‚“ãŸã‚“ -->
                        <div class="flex-1 rank-column">
                            <h4 class="text-blue-600 border-blue-500">-- ã‹ã‚“ãŸã‚“ --</h4>
                            <ol id="ranking-list-easy">
                                <!-- JSã§æŒ¿å…¥ -->
                            </ol>
                        </div>
                        
                        <!-- ãµã¤ã† -->
                        <div class="flex-1 rank-column">
                            <h4 class="text-yellow-600 border-yellow-500">-- ãµã¤ã† --</h4>
                            <ol id="ranking-list-medium">
                                <!-- JSã§æŒ¿å…¥ -->
                            </ol>
                        </div>
                        
                        <!-- ã‚€ãšã‹ã—ã„ -->
                        <div class="flex-1 rank-column">
                            <h4 class="text-red-600 border-red-500">-- ã‚€ãšã‹ã—ã„ --</h4>
                            <ol id="ranking-list-hard">
                                <!-- JSã§æŒ¿å…¥ -->
                            </ol>
                        </div>

                    </div>
                </div>
                <!-- â˜…â˜…â˜… ã“ã“ã¾ã§ â˜…â˜…â˜… -->
                
                <div class="space-y-4">
                    <button data-difficulty="tutorial" class="difficulty-btn game-button bg-green-500 hover:bg-green-600">
                        ãŠãŸã‚ã— (2ãƒšã‚¢)
                    </button>
                    <button data-difficulty="easy" class="difficulty-btn game-button bg-blue-500 hover:bg-blue-600">
                        ã‹ã‚“ãŸã‚“ (6ãƒšã‚¢)
                    </button>
                    <button data-difficulty="medium" class="difficulty-btn game-button bg-yellow-500 hover:bg-yellow-600">
                        ãµã¤ã† (8ãƒšã‚¢)
                    </button>
                    <button data-difficulty="hard" class="difficulty-btn game-button bg-red-500 hover:bg-red-600">
                        ã‚€ãšã‹ã—ã„ (10ãƒšã‚¢)
                    </button>
                    <button id="connect-back-button" class="game-button bg-gray-400 hover:bg-gray-500 mt-6">
                        ã‚‚ã©ã‚‹
                    </button>
                </div>
            </div>
        </div>

        <!-- 2. ã‚³ãƒã‚¯ãƒˆã‚²ãƒ¼ãƒ  ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div id="connect-game-screen" class="screen">
            <div class="w-full max-w-3xl mx-auto">
                <div class="flex justify-between items-center bg-white p-4 rounded-xl shadow-md mb-6">
                    <div>
                        <span class="text-lg font-bold text-gray-600">ã®ã“ã‚Šãƒšã‚¢:</span>
                        <span id="pairs-left" class="text-2xl font-extrabold text-blue-700">0</span>
                    </div>
                    <div>
                        <span class="text-lg font-bold text-gray-600">ã˜ã‹ã‚“:</span>
                        <span id="timer" class="text-2xl font-extrabold text-red-600">0</span>
                    </div>
                    <!-- â˜… ãŠã‚ã‚‹ãƒœã‚¿ãƒ³è¿½åŠ  -->
                    <button id="connect-quit-game" class="text-sm font-bold bg-gray-200 text-gray-600 px-3 py-2 rounded-lg hover:bg-gray-300">
                        ãŠã‚ã‚‹
                    </button>
                </div>

                <div id="connect-game-board" class="grid gap-2 sm:gap-4">
                    <!-- ã‚«ãƒ¼ãƒ‰ã¯JSã§ç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>
            </div>
        </div>

        <!-- 3. ã‚³ãƒã‚¯ãƒˆã‚²ãƒ¼ãƒ  çµæœãƒ»è§£èª¬ç”»é¢ -->
        <div id="connect-result-screen" class="screen">
            <div class="text-center p-6 sm:p-10 bg-white rounded-2xl shadow-xl max-w-2xl w-full">
                <h2 id="connect-result-title" class="text-5xl font-extrabold text-yellow-500 mb-4">ã‚¯ãƒªã‚¢ï¼</h2>
                <p id="connect-result-time" class="text-2xl text-gray-700 mb-8">ã‹ã‹ã£ãŸã˜ã‹ã‚“: 60ã³ã‚‡ã†</p>
                
                <div class="explanation-list">
                    <h3>ã¿ã¤ã‘ãŸã€Œã¤ãªãŒã‚Šã€ã„ã¡ã‚‰ã‚“</h3>
                    <div id="connect-explanation-area" class="space-y-4">
                        <!-- è§£èª¬ã¯JSã§ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </div>
                </div>

                <button id="connect-restart-button" class="game-button bg-green-500 hover:bg-green-600">
                    ã‚‚ã†ã„ã¡ã© ã‚ãã¶
                </button>
            </div>
        </div>

        <!-- 4. ã•ãŒã—ã‚²ãƒ¼ãƒ  ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div id="find-game-screen" class="screen">
            <div class="w-full max-w-3xl mx-auto flex flex-col items-center">
                <h1 class="game-title text-yellow-600">ã„ãã‚‚ã® ã‹ãã‚Œã‚“ã¼</h1>
                <p class="game-subtitle">ã¿ã¤ã‘ã‚‰ã‚Œã‚‹ã‹ãªï¼Ÿ</p>
                
                <div id="find-game-targets">
                    <!-- ã•ãŒã™å¯¾è±¡ãƒªã‚¹ãƒˆãŒJSã§å…¥ã‚Šã¾ã™ -->
                    <!-- â˜… ãŠã‚ã‚‹ãƒœã‚¿ãƒ³è¿½åŠ  -->
                    <button id="find-quit-game" class="absolute top-2 right-2 text-sm font-bold bg-gray-200 text-gray-600 px-3 py-2 rounded-lg hover:bg-gray-300">
                        ãŠã‚ã‚‹
                    </button>
                </div>
                
                <div id="find-game-area">
                    <svg id="find-game-svg" viewBox="0 0 400 300" preserveAspectRatio="xMidYMid slice">
                        <!-- SVGèƒŒæ™¯ã¨å‹•ç‰©ãŒJSã§å…¥ã‚Šã¾ã™ -->
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- 5. ã•ãŒã—ã‚²ãƒ¼ãƒ  çµæœç”»é¢ -->
        <div id="find-result-screen" class="screen">
            <div class="text-center p-6 sm:p-10 bg-white rounded-2xl shadow-xl max-w-2xl w-full">
                <h2 id="find-result-title" class="text-5xl font-extrabold text-yellow-500 mb-4">ãœã‚“ã¶ ã¿ã¤ã‘ãŸï¼</h2>
                <p id="find-result-message" class="text-2xl text-gray-700 mb-8">ã™ã”ã„ã­ï¼ã‹ã‚“ã•ã¤ ã‚ã„ã˜ã‚“ï¼</p>
                
                <div class="explanation-list">
                    <h3>ã¿ã¤ã‘ãŸã€Œã‹ãã‚Œã‚“ã¼ã€ã® ã²ã¿ã¤</h3>
                    <div id="find-explanation-area" class="space-y-4">
                        <!-- è§£èª¬ã¯JSã§ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </div>
                </div>

                <div class="space-y-4">
                    <button id="find-restart-button" class="game-button bg-green-500 hover:bg-green-600">
                        ã‚‚ã†ã„ã¡ã© ã‚ãã¶
                    </button>
                    <button id="find-back-button" class="game-button bg-gray-400 hover:bg-gray-500">
                        ã‚²ãƒ¼ãƒ ã‚’ ãˆã‚‰ã¶
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- å…±é€šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã›ã„ã‹ã„/ã–ã‚“ã­ã‚“/ãƒ’ãƒ³ãƒˆï¼‰ -->
    <div id="simple-modal-overlay" class="modal-overlay">
        <div id="simple-modal-content" class="">
            <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯JSã§è¨­å®š -->
        </div>
    </div>
    
    <!-- å…±é€š è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ« (ã‚³ãƒã‚¯ãƒˆ/ã•ãŒã— ä¸¡æ–¹ã§ä½¿ã†) -->
    <div id="explanation-modal-overlay" class="modal-overlay">
        <div id="explanation-modal-content">
            <p id="explanation-text">ã“ã“ã«è§£èª¬ãŒå…¥ã‚Šã¾ã™ã€‚</p>
            <button id="explanation-close-btn" class="game-button bg-blue-500 hover:bg-blue-600">
                ã¤ãã¸
            </button>
        </div>
    </div>

    <!-- ãƒ©ãƒ³ã‚¯ã‚¤ãƒ³å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="ranking-modal-overlay" class="modal-overlay">
        <div id="ranking-modal-content">
            <h2 class="text-3xl font-extrabold text-yellow-500 mb-3">ğŸ‰ãƒ©ãƒ³ã‚¯ã‚¤ãƒ³ï¼ğŸ‰</h2>
            <p id="ranking-modal-time" class="text-xl text-gray-700 mb-4">ã‚¿ã‚¤ãƒ : 00 ã³ã‚‡ã†</p>
            <p class="text-lg text-gray-600 mb-4">10ã„ ã„ãªã„ ã§ã™ï¼<br>ãªã¾ãˆã‚’ ã«ã‚…ã†ã‚Šã‚‡ã ã—ã¦ãã ã•ã„ã€‚</p>
            <input type="text" id="player-name-input" class="w-full p-3 border border-gray-300 rounded-lg text-lg transition-all" placeholder="ãªã¾ãˆ (8ã‚‚ã˜ ã¾ã§)" maxlength="8">
            <button id="ranking-submit-btn" class="game-button bg-green-500 hover:bg-green-600 mt-5">
                ã¨ã†ã‚ã
            </button>
        </div>
    </div>

    <!-- â˜… ã‚²ãƒ¼ãƒ çµ‚äº† ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="confirm-modal-overlay" class="modal-overlay">
        <div id="confirm-modal-content">
            <h3 class="text-xl font-bold mb-4">ã»ã‚“ã¨ã†ã« ãŠã‚ã‚Šã¾ã™ã‹ï¼Ÿ</h3>
            <p class="text-gray-600 mb-6">ã„ã¾ã®ã‚²ãƒ¼ãƒ ã¯ ããˆã¦ã—ã¾ã„ã¾ã™ã€‚</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-cancel-btn" class="game-button bg-gray-400 hover:bg-gray-500" style="width: 48%;">ã¤ã¥ã‘ã‚‹</button>
                <button id="confirm-ok-btn" class="game-button bg-red-500 hover:bg-red-600" style="width: 48%;">ãŠã‚ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚»ãƒƒãƒˆ ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« (æ–°è¦è¿½åŠ ) -->
    <div id="confirm-reset-modal" class="modal-overlay">
        <div id="confirm-modal-content"> <!-- æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æµç”¨ -->
            <h3 class="text-xl font-bold mb-4">ã‹ãã«ã‚“</h3>
            <p class="text-gray-600 mb-6">ã»ã‚“ã¨ã†ã« ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ ãœã‚“ã¶ ã‘ã—ã¾ã™ã‹ï¼Ÿ<br>ã‘ã—ãŸ ãƒ‡ãƒ¼ã‚¿ã¯ ã‚‚ã©ã‚Šã¾ã›ã‚“ã€‚</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-reset-cancel-btn" class="game-button bg-gray-400 hover:bg-gray-500" style="width: 48%;">ã‚„ã‚ã‚‹</button>
                <button id="confirm-reset-ok-btn" class="game-button bg-red-500 hover:bg-red-600" style="width: 48%;">ã‘ã™</button>
            </div>
        </div>
    </div>

    <!-- â˜… BGMç”¨ (Muteãƒœã‚¿ãƒ³ã¨Audioã‚¿ã‚°) -->
    <button id="mute-toggle-btn" class="fixed bottom-4 right-4 bg-white p-3 rounded-full shadow-lg z-50 text-lg font-bold">
        BGM ğŸµ
    </button>
    <!-- â˜… src ã‚’å‰Šé™¤ (JSã§è¨­å®š) -->
    <audio id="bgm" loop></audio>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 0. å…±é€š DOM ã¨ãƒ­ã‚¸ãƒƒã‚¯ ---
            const screens = {
                gameSelect: document.getElementById('game-select-screen'),
                settings: document.getElementById('settings-screen'), // â˜… è¿½åŠ 
                connectStart: document.getElementById('connect-start-screen'),
                connectGame: document.getElementById('connect-game-screen'),
                connectResult: document.getElementById('connect-result-screen'),
                findGame: document.getElementById('find-game-screen'),
                findResult: document.getElementById('find-result-screen'),
            };
            
            // ç°¡æ˜“ãƒ¢ãƒ¼ãƒ€ãƒ« DOM
            const simpleModalOverlay = document.getElementById('simple-modal-overlay');
            const simpleModalContent = document.getElementById('simple-modal-content');
            
            // è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ« DOM
            const explanationModalOverlay = document.getElementById('explanation-modal-overlay');
            const explanationText = document.getElementById('explanation-text');
            const explanationCloseBtn = document.getElementById('explanation-close-btn');

            // ãƒ©ãƒ³ã‚¯ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« DOM
            const rankingModalOverlay = document.getElementById('ranking-modal-overlay');
            const rankingModalTime = document.getElementById('ranking-modal-time');
            const playerNameInput = document.getElementById('player-name-input');
            const rankingSubmitBtn = document.getElementById('ranking-submit-btn');

            // â˜… ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« DOM (çµ‚äº†ç¢ºèª)
            const confirmModalOverlay = document.getElementById('confirm-modal-overlay');
            const confirmOkBtn = document.getElementById('confirm-ok-btn');
            const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
            let confirmModalTarget = ''; // 'connectGame' or 'findGame'

            // â˜… BGM DOM
            const bgm = document.getElementById('bgm');
            const muteToggleBtn = document.getElementById('mute-toggle-btn');

            // â˜… è¨­å®šç”»é¢ DOM (æ–°è¦è¿½åŠ )
            const settingsButton = document.getElementById('settings-button');
            const settingsBackButton = document.getElementById('settings-back-button');
            const volumeSlider = document.getElementById('volume-slider');
            const bgmSelect = document.getElementById('bgm-select');
            const resetRankingBtn = document.getElementById('reset-ranking-btn');
            const confirmResetModal = document.getElementById('confirm-reset-modal');
            const confirmResetOkBtn = document.getElementById('confirm-reset-ok-btn');
            const confirmResetCancelBtn = document.getElementById('confirm-reset-cancel-btn');
            
            // localStorageç”¨ã‚­ãƒ¼
            const RANKING_KEY = 'biodiversityGameRanking';
            const VOLUME_KEY = 'biodiversityGameVolume'; // â˜… è¿½åŠ 
            const BGM_KEY = 'biodiversityGameBGM'; // â˜… è¿½åŠ 

            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            function showScreen(screenId) {
                Object.values(screens).forEach(screen => screen.classList.remove('active'));
                screens[screenId].classList.add('active');

                // â˜… BGMå†ç”Ÿ/åœæ­¢
                if (screenId === 'connectGame' || screenId === 'findGame') {
                    // ã‚²ãƒ¼ãƒ ç”»é¢ã§å†ç”Ÿ
                    if (!bgm.muted && bgm.src) { // â˜… src ãŒã‚ã‚‹ã‹ç¢ºèª
                        bgm.play().catch(e => console.log("BGMå†ç”Ÿã‚¨ãƒ©ãƒ¼: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãŒå¿…è¦ã§ã™ã€‚"));
                    }
                } else {
                    // ãã‚Œä»¥å¤–ã®ç”»é¢ã§åœæ­¢
                    bgm.pause();
                    bgm.currentTime = 0;
                }
            }

            // ç°¡æ˜“ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºï¼ˆã›ã„ã‹ã„/ã–ã‚“ã­ã‚“/ãƒ’ãƒ³ãƒˆï¼‰
            function showSimpleModal(type, message, duration = 1200) {
                simpleModalContent.textContent = message;
                simpleModalContent.className = type === 'success' ? 'success' : 'error';
                simpleModalOverlay.style.display = 'flex';
                
                // â˜… duration ã‚’ 800ms (0.8s) ã«å¤‰æ›´ (ä¸æ­£è§£æ™‚)
                const displayDuration = type === 'error' ? 800 : duration;

                setTimeout(hideSimpleModal, displayDuration);
            }
            function hideSimpleModal() {
                simpleModalOverlay.style.display = 'none';
            }

            // â˜… BGMå†ç”Ÿ/åœæ­¢/ãƒŸãƒ¥ãƒ¼ãƒˆ
            function playBGM() {
                if (bgm.src && bgm.paused && !bgm.muted) { // â˜… src ãŒã‚ã‚Šã€ãƒŸãƒ¥ãƒ¼ãƒˆã§ãªã„ã‹ç¢ºèª
                    bgm.play().catch(e => console.log("BGM play failed:", e));
                }
            }
            function pauseBGM() {
                bgm.pause();
            }
            muteToggleBtn.addEventListener('click', () => {
                bgm.muted = !bgm.muted;
                // â˜… ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´
                muteToggleBtn.textContent = bgm.muted ? 'BGM ğŸ”‡' : 'BGM ğŸµ';
                
                // â˜… ãƒŸãƒ¥ãƒ¼ãƒˆã—ãŸã‚‰åœæ­¢ã€è§£é™¤ã—ãŸã‚‰å†ç”Ÿï¼ˆã‚²ãƒ¼ãƒ ä¸­ã®ã¿ï¼‰
                if (bgm.muted) {
                    pauseBGM();
                } else {
                    if (screens.connectGame.classList.contains('active') || screens.findGame.classList.contains('active')) {
                        playBGM();
                    }
                }
            });

            // ã‚²ãƒ¼ãƒ é¸æŠãƒœã‚¿ãƒ³ã®ãƒªã‚¹ãƒŠãƒ¼
            document.getElementById('select-connect-game').addEventListener('click', () => showScreen('connectStart'));
            document.getElementById('select-find-game').addEventListener('click', () => initFindGame());
            document.getElementById('connect-back-button').addEventListener('click', () => {
                showScreen('gameSelect');
            });
            // â˜… è¨­å®šç”»é¢ãƒªã‚¹ãƒŠãƒ¼ (æ–°è¦è¿½åŠ )
            settingsButton.addEventListener('click', () => showScreen('settings'));
            settingsBackButton.addEventListener('click', () => showScreen('gameSelect'));

            // â˜… éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãƒªã‚¹ãƒŠãƒ¼
            volumeSlider.addEventListener('input', (e) => {
                const volume = e.target.value;
                bgm.volume = volume;
                localStorage.setItem(VOLUME_KEY, volume);
            });

            // â˜… BGMé¸æŠãƒªã‚¹ãƒŠãƒ¼
            bgmSelect.addEventListener('change', (e) => {
                const selectedBGM = e.target.value;
                bgm.src = selectedBGM;
                localStorage.setItem(BGM_KEY, selectedBGM);
                // BGMã‚’å¤‰æ›´ã—ã¦ã™ãå†ç”Ÿ (ãƒŸãƒ¥ãƒ¼ãƒˆã§ãªã‘ã‚Œã°)
                if (!bgm.muted && (screens.connectGame.classList.contains('active') || screens.findGame.classList.contains('active'))) {
                    playBGM();
                }
            });

            // â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚»ãƒƒãƒˆãƒªã‚¹ãƒŠãƒ¼
            resetRankingBtn.addEventListener('click', () => {
                confirmResetModal.style.display = 'flex';
            });
            confirmResetOkBtn.addEventListener('click', () => {
                localStorage.removeItem(RANKING_KEY);
                displayRanking(); // è¡¨ç¤ºã‚’æ›´æ–°
                confirmResetModal.style.display = 'none';
            });
            confirmResetCancelBtn.addEventListener('click', () => {
                confirmResetModal.style.display = 'none';
            });

            // â˜… çµ‚äº†ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ãƒªã‚¹ãƒŠãƒ¼
            confirmCancelBtn.addEventListener('click', () => {
                confirmModalOverlay.style.display = 'none';
                // ã‚²ãƒ¼ãƒ ä¸­ã®å ´åˆã€ã‚¿ã‚¤ãƒãƒ¼ã‚„BGMã‚’å†é–‹
                if (confirmModalTarget === 'connectGame') {
                    startConnectTimer(true); // ã‚¿ã‚¤ãƒãƒ¼å†é–‹
                    playBGM(); // BGMå†é–‹
                } else if (confirmModalTarget === 'findGame') {
                    playBGM(); // BGMå†é–‹
                }
            });
            confirmOkBtn.addEventListener('click', () => {
                if (confirmModalTarget === 'connectGame') {
                    showScreen('connectStart');
                } else if (confirmModalTarget === 'findGame') {
                    showScreen('gameSelect');
                }
                confirmModalOverlay.style.display = 'none';
                stopConnectTimer(); // ã‚¿ã‚¤ãƒãƒ¼å®Œå…¨åœæ­¢
                // showScreenã§BGMã¯åœæ­¢ã•ã‚Œã‚‹
            });


            // --- 1. ã„ãã‚‚ã®ã‚³ãƒã‚¯ãƒˆï¼ˆç¥çµŒè¡°å¼±ï¼‰ ---
            const connectGameDoms = {
                board: document.getElementById('connect-game-board'),
                pairsLeft: document.getElementById('pairs-left'),
                timer: document.getElementById('timer'),
                resultTitle: document.getElementById('connect-result-title'),
                resultTime: document.getElementById('connect-result-time'),
                explanationArea: document.getElementById('connect-explanation-area'),
                restartBtn: document.getElementById('connect-restart-button'),
                quitGameBtn: document.getElementById('connect-quit-game'),
            };

            // â˜… ã‚«ãƒ¼ãƒ‰ã®ãƒšã‚¢å®šç¾©ï¼ˆé›£æ˜“åº¦ã”ã¨ã«é‡è¤‡ã—ãªã„ã‚ˆã†ã«ï¼‰
            const allPairs = {
                tutorial: [
                    { id: 't1', emoji: 'ğŸ¸', name: 'ã‚«ã‚¨ãƒ«', partner: 't2', exp: 'ã€Œã‚«ã‚¨ãƒ«ã€ã¨ã€Œã‚ªã‚¿ãƒã‚¸ãƒ£ã‚¯ã‚·ã€ã¯ ãŠãªã˜ã„ãã‚‚ã®ï¼ˆãŠã‚„ã“ï¼‰ã ã‚ˆã€‚ã¿ãšã®ãªã‹ã‹ã‚‰ ã‚Šãã®ã†ãˆã« ã™ã‚€ã°ã—ã‚‡ãŒ ã‹ã‚ã‚‹ã‚“ã ã€‚' },
                    { id: 't2', emoji: '...<br>ğŸ¸', name: 'ã‚ªã‚¿ãƒã‚¸ãƒ£ã‚¯ã‚·', partner: 't1', exp: 'ã€Œã‚ªã‚¿ãƒã‚¸ãƒ£ã‚¯ã‚·ã€ã¯ã€Œã‚«ã‚¨ãƒ«ã€ã® ã‚ã‹ã¡ã‚ƒã‚“ã ã‚ˆã€‚ãŠãŠãããªã‚‹ã¨ ã¦ã‚ã—ãŒ ã¯ãˆã¦ãã‚‹ã‚“ã ã€‚' }
                ],
                easy: [
                    { id: 'e1', emoji: 'ğŸ¦‹', name: 'ãƒãƒ§ã‚¦', partner: 'e2', exp: 'ã€Œãƒãƒ§ã‚¦ã€ã¯ã€Œã‚ˆã†ã¡ã‚…ã†ã€ãŒ ã›ã„ã¡ã‚‡ã†ã—ãŸ ã™ãŒãŸã ã‚ˆã€‚' },
                    { id: 'e2', emoji: 'ğŸ›', name: 'ã‚ˆã†ã¡ã‚…ã†', partner: 'e1', exp: 'ã€Œã‚ˆã†ã¡ã‚…ã†ã€ã¯ã€Œãƒãƒ§ã‚¦ã€ã® ã‚ã‹ã¡ã‚ƒã‚“ã€‚ã¯ã£ã±ã‚’ ãŸã¹ã¦ ãŠãŠãããªã‚‹ã‚ˆã€‚' },
                    { id: 'e3', emoji: 'ğŸ', name: 'ãƒŸãƒ„ãƒãƒ', partner: 'e4', exp: 'ã€ŒãƒŸãƒ„ãƒãƒã€ã¯ã€Œã¯ãªã€ã® ã¿ã¤ã‚’ ã‚ã¤ã‚ã‚‹ã‚ˆã€‚ã“ã®ã¨ãã€ã‹ãµã‚“ã‚’ ã¯ã“ã‚“ã§ ã‚ã’ã‚‹ã‚“ã ã€‚ï¼ˆã˜ã‚…ãµã‚“ï¼‰' },
                    { id: 'e4', emoji: 'ğŸŒ¸', name: 'ã¯ãª', partner: 'e3', exp: 'ã€Œã¯ãªã€ã¯ã€ŒãƒŸãƒ„ãƒãƒã€ã« ã¿ã¤ã‚’ ã‚ã’ã‚‹ ã‹ã‚ã‚Šã«ã€ã‹ãµã‚“ã‚’ ã¯ã“ã‚“ã§ã‚‚ã‚‰ã†ã‚ˆã€‚' },
                    { id: 'e5', emoji: 'ğŸ', name: 'ãƒ†ãƒ³ãƒˆã‚¦ãƒ ã‚·', partner: 'e6', exp: 'ã€Œãƒ†ãƒ³ãƒˆã‚¦ãƒ ã‚·ã€ã¯ã€Œã‚¢ãƒ–ãƒ©ãƒ ã‚·ã€ã‚’ ãŸã¹ã¦ãã‚Œã‚‹ã€ã¯ãŸã‘ã® ã¿ã‹ãŸã ã‚ˆã€‚' },
                    { id: 'e6', emoji: '...<br>ğŸœ', name: 'ã‚¢ãƒ–ãƒ©ãƒ ã‚·', partner: 'e5', exp: 'ã€Œã‚¢ãƒ–ãƒ©ãƒ ã‚·ã€ã¯ ã—ã‚‡ãã¶ã¤ã® ã—ã‚‹ã‚’ ã™ã† ã¡ã„ã•ãªãƒ ã‚·ã€‚ãƒ†ãƒ³ãƒˆã‚¦ãƒ ã‚·ã® ã”ã¯ã‚“ã ã‚ˆã€‚' },
                    { id: 'e7', emoji: '...<br>ğŸ•·ï¸', name: 'ã‚¯ãƒ¢', partner: 'e8', exp: 'ã€Œã‚¯ãƒ¢ã€ã¯ ã™ã‚’ ã¯ã£ã¦ã€ã¤ã‹ã¾ãˆãŸã€Œã‚³ãƒã‚¨ã€ãªã©ã® ã¡ã„ã•ãªãƒ ã‚·ã‚’ ãŸã¹ã‚‹ã‚ˆã€‚' },
                    { id: 'e8', emoji: '...<br>ğŸ¦Ÿ', name: 'ã‚³ãƒã‚¨', partner: 'e7', exp: 'ã€Œã‚³ãƒã‚¨ã€ãªã©ã® ã¡ã„ã•ãªãƒ ã‚·ã¯ã€ã€Œã‚¯ãƒ¢ã€ã® ã”ã¯ã‚“ã«ãªã‚‹ã‚“ã ã€‚' },
                    { id: 'e9', emoji: 'ğŸ’', name: 'ãã® ã¿', partner: 'e10', exp: 'ã€Œãã® ã¿ã€ã¯ã€Œã‚¯ãƒã€ã® ã ã„ã˜ãª ãŸã¹ã‚‚ã®ã€‚ã‚‚ã‚Šã§ ãã‚‰ã™ ã©ã†ã¶ã¤ã‚’ ã•ã•ãˆã‚‹ã‚ˆã€‚' },
                    { id: 'e10', emoji: 'ğŸ»', name: 'ã‚¯ãƒ', partner: 'e9', exp: 'ã€Œã‚¯ãƒã€ã¯ã€Œãã® ã¿ã€ã‚„ ã•ã‹ãªã‚’ ãŸã¹ã¦ ã„ãã¦ã„ã‚‹ã‚ˆã€‚' },
                    { id: 'e11', emoji: '...<br>ğŸŒ', name: 'ã‚«ã‚¿ãƒ„ãƒ ãƒª', partner: 'e12', exp: 'ã€Œã‚«ã‚¿ãƒ„ãƒ ãƒªã€ã¯ã€Œã‚¢ã‚¸ã‚µã‚¤ã€ã® ã¯ã£ã±ãŒ ã ã„ã™ãã€‚ã‚¸ãƒ¡ã‚¸ãƒ¡ã—ãŸ ã¨ã“ã‚ã« ã„ã‚‹ã‚ˆã€‚' },
                    { id: 'e12', emoji: '...<br>ğŸ’ ', name: 'ã‚¢ã‚¸ã‚µã‚¤', partner: 'e11', exp: 'ã€Œã‚¢ã‚¸ã‚µã‚¤ã€ãŒ ã•ã ã¤ã‚†ã® ãã›ã¤ã¯ã€ã€Œã‚«ã‚¿ãƒ„ãƒ ãƒªã€ã‚‚ ã‚ˆã ã¿ã‹ã‘ã‚‹ã­ã€‚' }
                ],
                medium: [
                    { id: 'm1', emoji: '...<br>ğŸ›', name: 'ã‚¢ã‚ªãƒ ã‚·', partner: 'm2', exp: 'ã€Œã‚¢ã‚ªãƒ ã‚·ã€ã¯ã€Œã‚­ãƒ£ãƒ™ãƒ„ã€ã® ã¯ã£ã±ã‚’ ãŸã¹ã¦ ãŠãŠãããªã‚‹ã€ãƒ¢ãƒ³ã‚·ãƒ­ãƒãƒ§ã‚¦ã® ã‚ˆã†ã¡ã‚…ã†ã ã‚ˆã€‚' },
                    { id: 'm2', emoji: 'ğŸ¥¬', name: 'ã‚­ãƒ£ãƒ™ãƒ„', partner: 'm1', exp: 'ã€Œã‚­ãƒ£ãƒ™ãƒ„ã€ã¯ã€Œã‚¢ã‚ªãƒ ã‚·ã€ã® ã ã„ã˜ãª ã”ã¯ã‚“ãªã‚“ã ã€‚' },
                    { id: 'm3', emoji: '...<br>ğŸ¦—', name: 'ãƒãƒƒã‚¿', partner: 'm4', exp: 'ã€Œãƒãƒƒã‚¿ã€ã¯ã€Œã‚¤ãƒã€ãªã©ã® ãã•ã‚’ ãŸã¹ã¦ ã„ãã¦ã„ã‚‹ã‚ˆã€‚' },
                    { id: 'm4', emoji: 'ğŸŒ¾', name: 'ã‚¤ãƒ', partner: 'm3', exp: 'ã€Œã‚¤ãƒã€ã¯ã€Œãƒãƒƒã‚¿ã€ã« ãŸã¹ã‚‰ã‚Œã¦ã—ã¾ã† ã“ã¨ãŒ ã‚ã‚‹ã‚“ã ã€‚' },
                    { id: 'm5', emoji: '...<br>ğŸœ', name: 'ã‚¢ãƒª', partner: 'm6', exp: 'ã€Œã‚¢ãƒªã€ã¯ã€Œã‚¢ãƒ–ãƒ©ãƒ ã‚·ã€ãŒ ã ã™ ã‚ã¾ã„ ã—ã‚‹ã‚’ ã‚‚ã‚‰ã† ã‹ã‚ã‚Šã«ã€ã¦ãã‹ã‚‰ ã¾ã‚‚ã£ã¦ ã‚ã’ã‚‹ã‚“ã ã€‚ï¼ˆãã‚‡ã†ã›ã„ï¼‰' },
                    { id: 'm6', emoji: '...<br>ğŸœ', name: 'ã‚¢ãƒ–ãƒ©ãƒ ã‚·', partner: 'm5', exp: 'ã€Œã‚¢ãƒ–ãƒ©ãƒ ã‚·ã€ã¯ã€Œã‚¢ãƒªã€ã« ã‚ã¾ã„ ã—ã‚‹ã‚’ ã‚ã’ã¦ã€ã¾ã‚‚ã£ã¦ã‚‚ã‚‰ã†ã‚ˆã€‚ï¼ˆãã‚‡ã†ã›ã„ï¼‰' },
                    { id: 'm7', emoji: '...<br>ğŸª²', name: 'ã‚«ãƒ–ãƒˆãƒ ã‚·', partner: 'm8', exp: 'ã€Œã‚«ãƒ–ãƒˆãƒ ã‚·ã€ã¯ã€Œã‚¯ãƒŒã‚®ã€ãªã©ã® ãã® ã˜ã‚…ãˆããŒ ã ã„ã™ããªã‚“ã ã€‚' },
                    { id: 'm8', emoji: 'ğŸŒ³', name: 'ã‚¯ãƒŒã‚®ã®ã', partner: 'm7', exp: 'ã€Œã‚¯ãƒŒã‚®ã®ãã€ãŒ ã ã™ ã˜ã‚…ãˆãã¯ã€ã€Œã‚«ãƒ–ãƒˆãƒ ã‚·ã€ãŸã¡ã® ã”ã¡ãã†ã ã‚ˆã€‚' },
                    { id: 'm9', emoji: '...<br>ğŸ¦', name: 'ãƒˆã‚«ã‚²', partner: 'm10', exp: 'ã€Œãƒˆã‚«ã‚²ã€ã¯ã€Œãƒãƒƒã‚¿ã€ãªã©ã® ã¡ã„ã•ãªãƒ ã‚·ã‚’ ã¤ã‹ã¾ãˆã¦ ãŸã¹ã‚‹ã‚ˆã€‚' },
                    { id: 'm10', emoji: '...<br>ğŸ¦—', name: 'ãƒãƒƒã‚¿', partner: 'm9', exp: 'ã€Œãƒãƒƒã‚¿ã€ã¯ ãã•ã‚’ ãŸã¹ã‚‹ã‘ã©ã€ã€Œãƒˆã‚«ã‚²ã€ã« ãŸã¹ã‚‰ã‚Œã¦ã—ã¾ã† ã“ã¨ã‚‚ ã‚ã‚‹ã‚“ã ã€‚' },
                    { id: 'm11', emoji: 'ğŸ¦…', name: 'ã‚¿ã‚«', partner: 'm12', exp: 'ã€Œã‚¿ã‚«ã€ã¯ ã¨ã¦ã‚‚ ã‚ãŒ ã‚ˆãã¦ã€ãã‚‰ã‹ã‚‰ã€Œãƒ˜ãƒ“ã€ã‚’ ã¿ã¤ã‘ã¦ ã¤ã‹ã¾ãˆã‚‹ã‚ˆã€‚' },
                    { id: 'm12', emoji: 'ğŸ', name: 'ãƒ˜ãƒ“', partner: 'm11', exp: 'ã€Œãƒ˜ãƒ“ã€ã¯ ã‚«ã‚¨ãƒ«ã‚„ ãƒã‚ºãƒŸã‚’ ãŸã¹ã‚‹ã‘ã©ã€ã€Œã‚¿ã‚«ã€ã« ãŸã¹ã‚‰ã‚Œã¦ã—ã¾ã† ã“ã¨ã‚‚ ã‚ã‚‹ã‚“ã ã€‚' },
                    { id: 'm13', emoji: '...<br>ğŸ¦‰', name: 'ãƒ•ã‚¯ãƒ­ã‚¦', partner: 'm14', exp: 'ã€Œãƒ•ã‚¯ãƒ­ã‚¦ã€ã¯ ã‚ˆã‚‹ã« ã‹ã¤ã©ã†ã—ã€ã€Œãƒã‚ºãƒŸã€ãªã©ã‚’ ã¤ã‹ã¾ãˆã¦ ãŸã¹ã‚‹ã‚ˆã€‚' },
                    { id: 'm14', emoji: '...<br>ğŸ', name: 'ãƒã‚ºãƒŸ', partner: 'm13', exp: 'ã€Œãƒã‚ºãƒŸã€ã¯ã€Œãƒ•ã‚¯ãƒ­ã‚¦ã€ã‚„ ãƒ˜ãƒ“ã€ã‚¿ã‚«ãªã©ã€ã„ã‚ã„ã‚ãª ã©ã†ã¶ã¤ã® ã”ã¯ã‚“ã«ãªã‚‹ã‚“ã ã€‚' },
                    { id: 'm15', emoji: '...<br>ğŸ‚', name: 'ãŠã¡ã°', partner: 'm16', exp: 'ã€ŒãŠã¡ã°ã€ã¯ã€Œãƒ€ãƒ³ã‚´ãƒ ã‚·ã€ã‚„ ãƒŸãƒŸã‚ºã« ã¶ã‚“ã‹ã„ã•ã‚Œã¦ã€ã¤ã¡ã® ãˆã„ã‚ˆã†ã« ãªã‚‹ã‚ˆã€‚' },
                    { id: 'm16', emoji: '...<br>âš«', name: 'ãƒ€ãƒ³ã‚´ãƒ ã‚·', partner: 'm15', exp: 'ã€Œãƒ€ãƒ³ã‚´ãƒ ã‚·ã€ã¯ã€ŒãŠã¡ã°ã€ã‚’ ãŸã¹ã¦ã€ã¤ã¡ã‚’ ã‚†ãŸã‹ã« ã™ã‚‹ã€ŒãŠãã†ã˜ã‚„ã•ã‚“ã€ãªã‚“ã ã€‚' }
                ],
                hard: [
                    { id: 'h1', emoji: 'ğŸ„', name: 'ã‚­ãƒã‚³', partner: 'h2', exp: 'ã€Œã‚­ãƒã‚³ã€ã‚„ã€Œã‚«ãƒ“ã€ã¯ã€ã—ã‚“ã  ãã‚’ ã¶ã‚“ã‹ã„ã—ã¦ã€ã¤ã¡ã« ãˆã„ã‚ˆã†ã‚’ ã‚‚ã©ã™ã‚ˆã€‚' },
                    { id: 'h2', emoji: '...<br>ğŸŒ²', name: 'ã—ã‚“ã  ã', partner: 'h1', exp: 'ã€Œã—ã‚“ã  ãã€ã¯ã€ã€Œã‚­ãƒã‚³ã€ã‚„ ã‚«ãƒ“ã€ãƒ ã‚·ãŸã¡ã« ã¶ã‚“ã‹ã„ã•ã‚Œã¦ã€ã¤ã¡ã« ã‹ãˆã‚‹ã‚“ã ã€‚' },
                    { id: 'h3', emoji: '...<br>ğŸ’§', name: 'ã¿ãšãŸã¾ã‚Š', partner: 'h4', exp: 'ã€Œã¿ãšãŸã¾ã‚Šã€ã¯ã€Œãƒœã‚¦ãƒ•ãƒ©ã€ãŒ ãã ã¤ ã°ã—ã‚‡ã€‚ã“ã‚ŒãŒ ãªã„ã¨ ã‚«ã¯ ã†ã¾ã‚Œãªã„ã‚ˆã€‚' },
                    { id: 'h4', emoji: '...<br>ğŸ¦Ÿ', name: 'ãƒœã‚¦ãƒ•ãƒ©', partner: 'h3', exp: 'ã€Œãƒœã‚¦ãƒ•ãƒ©ã€ã¯ ã‚«ã® ã‚ã‹ã¡ã‚ƒã‚“ã€‚ã€Œã¿ãšãŸã¾ã‚Šã€ãªã©ã® ã¡ã„ã•ãª ã¿ãšãŸã¾ã‚Šã§ ãã ã¤ã‚ˆã€‚' },
                    { id: 'h5', emoji: '...<br>ğŸŸ', name: 'ãƒ¡ãƒ€ã‚«', partner: 'h6', exp: 'ã€Œãƒ¡ãƒ€ã‚«ã€ã¯ã€Œãƒœã‚¦ãƒ•ãƒ©ã€ã‚’ ãŸã¹ã¦ãã‚Œã‚‹ã€ã‚„ãã«ãŸã¤ ã•ã‹ãªãªã‚“ã ã€‚' },
                    { id: 'h6', emoji: '...<br>ğŸ¦Ÿ', name: 'ãƒœã‚¦ãƒ•ãƒ©', partner: 'h5', exp: 'ã€Œãƒœã‚¦ãƒ•ãƒ©ã€ã¯ã€Œãƒ¡ãƒ€ã‚«ã€ã® ã”ã¯ã‚“ã® ã²ã¨ã¤ã ã‚ˆã€‚' },
                    { id: 'h7', emoji: '...<br>â˜€ï¸', name: 'ãŸã„ã‚ˆã†', partner: 'h8', exp: 'ã€ŒãŸã„ã‚ˆã†ã€ã® ã²ã‹ã‚Šã¯ã€ã—ã‚‡ãã¶ã¤ãŒã€Œã“ã†ã”ã†ã›ã„ã€ã§ ãˆã„ã‚ˆã†ã‚’ ã¤ãã‚‹ã®ã« ã²ã¤ãªã‚“ã ã€‚' },
                    { id: 'h8', emoji: 'ğŸŒ¿', name: 'ã—ã‚‡ãã¶ã¤', partner: 'h7', exp: 'ã€Œã—ã‚‡ãã¶ã¤ã€ã¯ã€ŒãŸã„ã‚ˆã†ã€ã® ã²ã‹ã‚Šã‚’ ã‚ã³ã¦ã€ã¿ãšã¨ ãã†ãã® ã«ã•ã‚“ã‹ãŸã‚“ãã‹ã‚‰ ãˆã„ã‚ˆã†ã‚’ ã¤ãã‚‹ã‚ˆã€‚' },
                    { id: 'h9', emoji: '...<br>ğŸ¦‡', name: 'ã‚³ã‚¦ãƒ¢ãƒª', partner: 'h10', exp: 'ã€Œã‚³ã‚¦ãƒ¢ãƒªã€ã¯ ã¡ã‚‡ã†ãŠã‚“ã±ã‚’ ã ã—ã€ã¯ã­ã‹ãˆã£ã¦ããŸ ãŠã¨ã§ã€Œã‚¬ã€ãªã©ã® ã°ã—ã‚‡ã‚’ ã¿ã¤ã‘ã¦ ã¤ã‹ã¾ãˆã‚‹ã‚ˆã€‚' },
                    { id: 'h10', emoji: '...<br>ğŸ¦‹', name: 'ã‚¬', partner: 'h9', exp: 'ã‚ˆã‚‹ã« ã¨ã¶ã€Œã‚¬ã€ã¯ã€ã€Œã‚³ã‚¦ãƒ¢ãƒªã€ã® ã”ã¯ã‚“ã«ãªã‚‹ã‚“ã ã€‚' },
                    { id: 'h11', emoji: '...<br>ğŸ’©', name: 'ã©ã†ã¶ã¤ã®ãƒ•ãƒ³', partner: 'h12', exp: 'ã€Œã©ã†ã¶ã¤ã®ãƒ•ãƒ³ã€ã¯ã€ã€Œãƒ•ãƒ³ã‚³ãƒ­ã‚¬ã‚·ã€ãªã©ã®ãƒ ã‚·ã« ã¶ã‚“ã‹ã„ã•ã‚Œã¦ã€ã¤ã¡ã® ãˆã„ã‚ˆã†ã« ãªã‚‹ã‚ˆã€‚' },
                    { id: 'h12', emoji: '...<br>ğŸª²', name: 'ãƒ•ãƒ³ã‚³ãƒ­ã‚¬ã‚·', partner: 'h11', exp: 'ã€Œãƒ•ãƒ³ã‚³ãƒ­ã‚¬ã‚·ã€ã¯ã€Œã©ã†ã¶ã¤ã®ãƒ•ãƒ³ã€ã‚’ ã ã‚“ã”ã«ã—ã¦ ã¯ã“ã³ã€ãŸã¹ãŸã‚Š ãŸã¾ã”ã‚’ ã†ã‚“ã ã‚Š ã™ã‚‹ã‚ˆã€‚' },
                    { id: 'h13', emoji: '...<br>ğŸŒŠ', name: 'ã†ã¿', partner: 'h14', exp: 'ã€Œã†ã¿ã€ã«ã¯ã€Œã‚µãƒ³ã‚´ã€ãŒ ã„ã¦ã€ã¡ã„ã•ãª ã•ã‹ãªãŸã¡ã® ã‹ãã‚ŒãŒã« ãªã£ã¦ã„ã‚‹ã‚ˆã€‚' },
                    { id: 'h14', emoji: '...<br>ğŸ ', name: 'ã¡ã„ã•ãª ã•ã‹ãª', partner: 'h13', exp: 'ã€Œã¡ã„ã•ãª ã•ã‹ãªã€ã¯ã€ã€Œã†ã¿ã€ã® ãªã‹ã® ã‚µãƒ³ã‚´ã—ã‚‡ã†ã‚’ ã‹ãã‚ŒãŒã«ã—ã¦ ãã‚‰ã—ã¦ã„ã‚‹ã‚ˆã€‚' },
                    { id: 'h15', emoji: '...<br>ğŸ¦…', name: 'ãƒ¯ã‚·', partner: 'h16', exp: 'ã€Œãƒ¯ã‚·ã€ã¯ã€Œã‚¦ã‚µã‚®ã€ã‚’ ã¤ã‹ã¾ãˆã¦ ãŸã¹ã‚‹ã‚ˆã€‚ã—ãœã‚“ã® ãƒãƒ©ãƒ³ã‚¹ã‚’ ãŸã‚‚ã¤ ã‚„ãã‚ã‚ŠãŒ ã‚ã‚‹ã‚“ã ã€‚' },
                    { id: 'h16', emoji: '...<br>ğŸ‡', name: 'ã‚¦ã‚µã‚®', partner: 'h15', exp: 'ã€Œã‚¦ã‚µã‚®ã€ã¯ ãã•ã‚’ ãŸã¹ã‚‹ã‘ã©ã€ã€Œãƒ¯ã‚·ã€ãªã©ã® ã©ã†ã¶ã¤ã« ãŸã¹ã‚‰ã‚Œã‚‹ ã“ã¨ã‚‚ ã‚ã‚‹ã‚ˆã€‚' },
                    { id: 'h17', emoji: '...<br>ğŸŒ¸', name: 'ã‚µã‚¯ãƒ©', partner: 'h18', exp: 'ã€Œã‚µã‚¯ãƒ©ã€ã® ã¯ãªã³ã‚‰ãŒ ã¡ã‚‹ã¨ã€ã¤ãã¯ã€Œã¯ã£ã±ã€ãŒ ã§ã¦ãã¦ã€ã²ã‹ã‚Šã‚’ ã‚ã¤ã‚ã‚‹ã‚ˆã€‚' },
                    { id: 'h18', emoji: '...<br>ğŸƒ', name: 'ã‚µã‚¯ãƒ©ã®ã¯ã£ã±', partner: 'h17', exp: 'ã€Œã‚µã‚¯ãƒ©ã®ã¯ã£ã±ã€ã¯ã€ã¯ã‚‹ã« ã¯ãªãŒ ãŠã‚ã£ãŸ ã‚ã¨ã€ãªã¤ã® ã‚ã„ã ã« ãˆã„ã‚ˆã†ã‚’ ã¤ãã‚‹ã‚“ã ã€‚' },
                    { id: 'h19', emoji: '...<br>ğŸŒ°', name: 'ãƒ‰ãƒ³ã‚°ãƒª', partner: 'h20', exp: 'ã€Œãƒ‰ãƒ³ã‚°ãƒªã€ã¯ã€Œã‚«ã‚·ãƒ¯ã€ãªã©ã® ãã® ã¿ã€‚ãƒªã‚¹ã‚„ ã‚¤ãƒã‚·ã‚·ã® ãŸã¹ã‚‚ã®ã« ãªã‚‹ã‚ˆã€‚' },
                    { id: 'h20', emoji: '...<br>ğŸŒ³', name: 'ã‚«ã‚·ãƒ¯ã®ã', partner: 'h19', exp: 'ã€Œã‚«ã‚·ãƒ¯ã®ãã€ã¯ã€ã‚ãã«ã€Œãƒ‰ãƒ³ã‚°ãƒªã€ã® ã¿ã‚’ ã¤ã‘ã‚‹ã‚“ã ã€‚' }
                ]
            };
            
            let firstCard = null;
            let secondCard = null;
            let lockBoard = false; // ã‚«ãƒ¼ãƒ‰æ“ä½œã‚’ãƒ­ãƒƒã‚¯
            let pairsToMatch = 0;
            let matchedPairs = 0;
            let timerInterval = null;
            let seconds = 0;
            let currentDifficulty = '';
            let currentExplanations = [];
            let wrongStreak = 0; // â˜… ä¸æ­£è§£ã‚«ã‚¦ãƒ³ãƒˆ

            // â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—
            function getRanking(difficulty) {
                const rankings = JSON.parse(localStorage.getItem(RANKING_KEY)) || {};
                return rankings[difficulty] || [];
            }
            // â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
            function displayRanking() {
                const difficulties = ['easy', 'medium', 'hard'];
                difficulties.forEach(diff => {
                    const rankingList = document.getElementById(`ranking-list-${diff}`);
                    rankingList.innerHTML = '';
                    const rankings = getRanking(diff);
                    if (rankings.length === 0) {
                        rankingList.innerHTML = '<li class="text-gray-500 italic p-2">ã¾ã  ãã‚ããŒ ã‚ã‚Šã¾ã›ã‚“</li>';
                    } else {
                        rankings.forEach((rank, index) => {
                            const li = document.createElement('li');
                            li.innerHTML = `<span class="rank-name">${index + 1}. ${rank.name}</span> <span class="rank-time">${rank.time} ã³ã‚‡ã†</span>`;
                            rankingList.appendChild(li);
                        });
                    }
                });
            }

            // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
            function initConnectGame(difficulty) {
                currentDifficulty = difficulty;
                currentExplanations = [];
                connectGameDoms.board.innerHTML = '';
                connectGameDoms.board.className = 'grid gap-2 sm:gap-4'; // ã‚¯ãƒ©ã‚¹ãƒªã‚»ãƒƒãƒˆ
                connectGameDoms.board.classList.add(`grid-${difficulty}`);
                
                firstCard = null;
                secondCard = null;
                lockBoard = false;
                matchedPairs = 0;
                wrongStreak = 0;
                
                let cardsData = [];
                if (difficulty === 'tutorial') {
                    cardsData = [...allPairs.tutorial];
                } else if (difficulty === 'easy') {
                    cardsData = [...allPairs.easy];
                } else if (difficulty === 'medium') {
                    cardsData = [...allPairs.medium];
                } else if (difficulty === 'hard') {
                    cardsData = [...allPairs.hard];
                }
                
                pairsToMatch = cardsData.length / 2;
                connectGameDoms.pairsLeft.textContent = pairsToMatch;

                const shuffledCards = shuffleArray(cardsData);
                createBoard(shuffledCards);
                
                showScreen('connectGame');
                startConnectTimer(false); // ã‚¿ã‚¤ãƒãƒ¼ã‚’æ–°è¦é–‹å§‹
            }
            
            // é…åˆ—ã‚·ãƒ£ãƒƒãƒ•ãƒ« (Fisher-Yates)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // ãƒœãƒ¼ãƒ‰ä½œæˆ
            function createBoard(cardsData) {
                cardsData.forEach(cardData => {
                    const card = document.createElement('div');
                    card.classList.add('card');
                    card.dataset.id = cardData.id;
                    card.dataset.partner = cardData.partner;
                    card.dataset.name = cardData.name;
                    card.dataset.emoji = cardData.emoji;
                    card.dataset.exp = cardData.exp;

                    card.innerHTML = `
                        <div class="card-inner">
                            <div class="card-face card-back">ğŸ¤</div>
                            <div class="card-face card-front">${cardData.emoji}</div>
                        </div>
                    `;
                    card.addEventListener('click', () => handleCardClick(card));
                    connectGameDoms.board.appendChild(card);
                });
            }

            // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
            function handleCardClick(clickedCard) {
                if (lockBoard || clickedCard === firstCard || clickedCard.classList.contains('is-matched')) {
                    return;
                }
                
                clickedCard.classList.add('is-flipped');

                if (!firstCard) {
                    firstCard = clickedCard;
                    return;
                }

                secondCard = clickedCard;
                lockBoard = true; // 2æšã‚ãã£ãŸã‚‰ãƒ­ãƒƒã‚¯
                
                // â˜… å°‘ã—å¾…ã£ã¦ã‹ã‚‰åˆ¤å®š
                setTimeout(checkForMatch, 500);
            }

            // ãƒšã‚¢åˆ¤å®š
            function checkForMatch() {
                const isMatch = firstCard.dataset.id === secondCard.dataset.partner;
                
                if (isMatch) {
                    // â˜… æ­£è§£æ™‚
                    wrongStreak = 0; // ä¸æ­£è§£ã‚«ã‚¦ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ
                    showSimpleModal('success', 'ã›ã„ã‹ã„ï¼', 500); // ã™ãæ¶ˆã™
                    
                    // â˜… ã™ãã«è§£èª¬è¡¨ç¤º
                    const exp1 = `<b>${firstCard.dataset.name} (${firstCard.dataset.emoji})</b>:<br>${firstCard.dataset.exp}`;
                    const exp2 = `<b>${secondCard.dataset.name} (${secondCard.dataset.emoji})</b>:<br>${secondCard.dataset.exp}`;
                    // ãƒšã‚¢ã®è§£èª¬ã‚’ã‚­ãƒ¥ãƒ¼ã«å…¥ã‚Œã‚‹
                    currentExplanations.push({exp1, exp2});
                    
                    // 0.5ç§’å¾…ã£ã¦ã‹ã‚‰è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
                    setTimeout(showNextExplanation, 500);
                    
                } else {
                    // â˜… ä¸æ­£è§£æ™‚
                    wrongStreak++;
                    showSimpleModal('error', 'ã–ã‚“ã­ã‚“â€¦'); // 0.8ç§’è¡¨ç¤º
                    // 0.8ç§’å¾…ã£ã¦ã‹ã‚‰è£è¿”ã™
                    setTimeout(unflipCards, 800);
                    
                    // â˜… 5å›é€£ç¶šã§é–“é•ãˆãŸã‚‰ãƒ’ãƒ³ãƒˆ
                    if (wrongStreak >= 5) {
                        wrongStreak = 0;
                        setTimeout(showHint, 1000); // 1ç§’å¾Œ
                    }
                }
            }
            
            // â˜… è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é †æ¬¡è¡¨ç¤º
            function showNextExplanation() {
                if (currentExplanations.length > 0) {
                    const pairExp = currentExplanations.shift(); // æœ€åˆã®è§£èª¬ã‚’å–ã‚Šå‡ºã™
                    explanationText.innerHTML = `${pairExp.exp1}<br><br>${pairExp.exp2}`;
                    explanationModalOverlay.style.display = 'flex';
                } else {
                    // ã™ã¹ã¦ã®è§£èª¬ãŒçµ‚ã‚ã£ãŸã‚‰
                    // ãƒãƒƒãƒã—ãŸã‚«ãƒ¼ãƒ‰ã‚’éè¡¨ç¤ºã«ã—ã€ãƒªã‚»ãƒƒãƒˆ
                    firstCard.classList.add('is-matched');
                    secondCard.classList.add('is-matched');
                    matchedPairs++;
                    connectGameDoms.pairsLeft.textContent = pairsToMatch - matchedPairs;
                    resetBoard();
                    
                    // å…¨ãƒšã‚¢æƒã£ãŸã‚‰ã‚²ãƒ¼ãƒ çµ‚äº†
                    if (matchedPairs === pairsToMatch) {
                        setTimeout(showConnectResult, 500);
                    }
                }
            }
            
            // è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
            explanationCloseBtn.addEventListener('click', () => {
                explanationModalOverlay.style.display = 'none';
                // æ¬¡ã®è§£èª¬ãŒã‚ã‚‹ã‹ã€ãªã‘ã‚Œã°ã‚²ãƒ¼ãƒ ã‚’ç¶šè¡Œ
                showNextExplanation();
            });

            // ã‚«ãƒ¼ãƒ‰ã‚’è£è¿”ã™
            function unflipCards() {
                firstCard.classList.remove('is-flipped');
                secondCard.classList.remove('is-flipped');
                resetBoard();
            }

            // ãƒœãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
            function resetBoard() {
                [firstCard, secondCard] = [null, null];
                lockBoard = false;
            }

            // â˜… ãƒ’ãƒ³ãƒˆè¡¨ç¤º
            function showHint() {
                showSimpleModal('success', 'ãƒ’ãƒ³ãƒˆï¼ğŸ’¡', 1500);
                // ã¾ã ãƒãƒƒãƒã—ã¦ã„ãªã„ã‚«ãƒ¼ãƒ‰ã‚’ã™ã¹ã¦å–å¾—
                const unmatchedCards = Array.from(document.querySelectorAll('.card:not(.is-matched)'));
                if (unmatchedCards.length > 0) {
                    // ãƒ©ãƒ³ãƒ€ãƒ ã«1æšé¸ã¶
                    const hintCard1 = unmatchedCards[Math.floor(Math.random() * unmatchedCards.length)];
                    // ãã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚’æ¢ã™
                    const partnerId = hintCard1.dataset.partner;
                    const hintCard2 = document.querySelector(`.card[data-id="${partnerId}"]`);
                    
                    if (hintCard2) {
                        // 2æšã®ã‚«ãƒ¼ãƒ‰ã‚’å…‰ã‚‰ã›ã‚‹
                        hintCard1.classList.add('is-hinting');
                        hintCard2.classList.add('is-hinting');
                        setTimeout(() => {
                            hintCard1.classList.remove('is-hinting');
                            hintCard2.classList.remove('is-hinting');
                        }, 1500); // 1.5ç§’å…‰ã‚‰ã›ã‚‹
                    }
                }
            }

            // çµæœè¡¨ç¤º
            function showConnectResult() {
                stopConnectTimer();
                showScreen('connectResult');
                
                const timeTaken = seconds;
                connectGameDoms.resultTitle.textContent = 'ã‚¯ãƒªã‚¢ï¼ğŸ‰';
                connectGameDoms.resultTime.textContent = `ã‹ã‹ã£ãŸã˜ã‹ã‚“: ${timeTaken} ã³ã‚‡ã†`;
                
                // è§£èª¬ã‚¨ãƒªã‚¢ã®ç”Ÿæˆ
                connectGameDoms.explanationArea.innerHTML = '';
                const allCardsData = allPairs[currentDifficulty];
                const explanationsToShow = [];
                // å¶æ•°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒšã‚¢ã®ç‰‡æ–¹ï¼‰ã ã‘ãƒ«ãƒ¼ãƒ—
                for (let i = 0; i < allCardsData.length; i += 2) {
                    const card1 = allCardsData[i];
                    const card2 = allPairs[currentDifficulty].find(c => c.id === card1.partner);
                    if (card2) {
                        const expHtml = `
                            <div class="p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                                <b>${card1.name} (${card1.emoji}) ğŸ¤ ${card2.name} (${card2.emoji})</b><br>
                                <span class="text-sm text-gray-700">${card1.exp}</span>
                            </div>
                        `;
                        explanationsToShow.push(expHtml);
                    }
                }
                connectGameDoms.explanationArea.innerHTML = explanationsToShow.join('');

                // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ä»¥å¤–ãªã‚‰ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯
                if (currentDifficulty !== 'tutorial') {
                    checkRanking(timeTaken, currentDifficulty);
                }
            }

            // â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯
            function checkRanking(time, difficulty) {
                const rankings = getRanking(difficulty);
                if (rankings.length < 10 || time < rankings[rankings.length - 1].time) {
                    // ãƒ©ãƒ³ã‚¯ã‚¤ãƒ³
                    rankingModalTime.textContent = `ã‚¿ã‚¤ãƒ : ${time} ã³ã‚‡ã†`;
                    rankingModalOverlay.style.display = 'flex';
                }
            }

            // â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¿å­˜
            function saveRanking(name, time, difficulty) {
                const allRankings = JSON.parse(localStorage.getItem(RANKING_KEY)) || {};
                const rankings = allRankings[difficulty] || [];
                
                const newScore = { name: name || 'ãªãªã—ã•ã‚“', time: time };
                rankings.push(newScore);
                
                // ã‚¿ã‚¤ãƒ ã§æ˜‡é †ã‚½ãƒ¼ãƒˆ
                rankings.sort((a, b) => a.time - b.time);
                
                // 10ä½ã¾ã§ä¿æŒ
                allRankings[difficulty] = rankings.slice(0, 10);
                
                localStorage.setItem(RANKING_KEY, JSON.stringify(allRankings));
            }

            // â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ²å‡¦ç†
            function handleRankingSubmit() {
                const name = playerNameInput.value;
                const time = seconds;
                
                if (!name || name.trim() === '') {
                    // â˜… ä¿®æ­£: 'break;' ã¯ç„¡åŠ¹ã€‚'return;' ã‚’ä½¿ã„ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¿½åŠ ã€‚
                    playerNameInput.classList.add('is-invalid');
                    setTimeout(() => {
                        playerNameInput.classList.remove('is-invalid');
                    }, 500); // 0.5ç§’å¾Œã«ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                    return; 
                }

                saveRanking(name, time, currentDifficulty);
                rankingModalOverlay.style.display = 'none';
                playerNameInput.value = '';
                displayRanking(); // ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°
            }

            // ã‚¿ã‚¤ãƒãƒ¼
            function startConnectTimer(isResume) {
                if (!isResume) {
                    seconds = 0; // æ–°è¦ã‚¹ã‚¿ãƒ¼ãƒˆ
                }
                connectGameDoms.timer.textContent = seconds;
                // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚Œã°åœæ­¢
                if(timerInterval) clearInterval(timerInterval);
                
                timerInterval = setInterval(() => {
                    seconds++;
                    connectGameDoms.timer.textContent = seconds;
                }, 1000);
            }
            function stopConnectTimer() {
                clearInterval(timerInterval);
                timerInterval = null; // ã‚¿ã‚¤ãƒãƒ¼IDã‚’ãƒªã‚»ãƒƒãƒˆ
            }

            // --- ã‚³ãƒã‚¯ãƒˆã‚²ãƒ¼ãƒ  ãƒªã‚¹ãƒŠãƒ¼ ---
            document.querySelectorAll('.difficulty-btn').forEach(button => {
                button.addEventListener('click', () => {
                    initConnectGame(button.dataset.difficulty);
                });
            });
            rankingSubmitBtn.addEventListener('click', handleRankingSubmit);
            connectGameDoms.restartBtn.addEventListener('click', () => {
                showScreen('connectStart');
            });
            // â˜… ãŠã‚ã‚‹ãƒœã‚¿ãƒ³
            connectGameDoms.quitGameBtn.addEventListener('click', () => {
                confirmModalTarget = 'connectGame';
                confirmModalOverlay.style.display = 'flex';
                pauseBGM(); // ç¢ºèªä¸­ã¯BGMåœæ­¢
                stopConnectTimer(); // ç¢ºèªä¸­ã¯ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
            });

            // --- 2. ã„ãã‚‚ã® ã‹ãã‚Œã‚“ã¼ ---
            const findGameDoms = {
                targets: document.getElementById('find-game-targets'),
                svg: document.getElementById('find-game-svg'),
                resultTitle: document.getElementById('find-result-title'),
                resultMsg: document.getElementById('find-result-message'),
                expArea: document.getElementById('find-explanation-area'),
                restartBtn: document.getElementById('find-restart-button'),
                backBtn: document.getElementById('find-back-button'),
                quitGameBtn: document.getElementById('find-quit-game'),
            };

            const findGameData = {
                // èƒŒæ™¯
                background: `<rect width="400" height="300" fill="#228B22" />` + // æ£®
                            `<rect width="400" height="150" y="150" fill="#8FBC8F" />` + // è‰ã‚€ã‚‰
                            `<path d="M50 150 Q 80 100 100 150 T 150 150 T 200 150 T 250 150 T 300 150 T 350 150" fill="none" stroke="#556B2F" stroke-width="2" />` + // ã¤ã‚‹
                            `<circle cx="350" cy="50" r="30" fill="#FFD700" />`, // å¤ªé™½
                // æ¢ã™ã„ãã‚‚ã®
                animals: [
                    { id: 'nanafu', name: 'ãƒŠãƒŠãƒ•ã‚·', hint: 'ãˆã ï¼Ÿ ã„ã„ãˆã€ãƒ ã‚·ã§ã™', exp: 'ã€ŒãƒŠãƒŠãƒ•ã‚·ã€ã¯ã€ã»ããªãŒã„ ã‹ã‚‰ã ã§ ãã® ãˆã ã« ãã£ãã‚Šï¼ã¦ãã‹ã‚‰ ã¿ã‚’ ã¾ã‚‚ã‚‹ã‚ˆã€‚ï¼ˆããŸã„ï¼‰', svg: `<path d="M100 120 L140 130 M110 123 L115 115 M130 127 L135 120" stroke="#8B4513" stroke-width="4" transform="rotate(15 120 125)" class="target-animal" />`},
                    { id: 'cho', name: 'ã‚³ãƒãƒãƒãƒ§ã‚¦', hint: 'ã‹ã‚ŒãŸ ã¯ã£ã±ï¼Ÿ', exp: 'ã€Œã‚³ãƒãƒãƒãƒ§ã‚¦ã€ã¯ã€ã¯ã­ã‚’ ã¨ã˜ã‚‹ã¨ ã¾ã‚‹ã§ ã‹ã‚Œã¯ï¼ã¦ãã‚’ ã‚ã–ã‚€ãã‚ˆã€‚ï¼ˆããŸã„ï¼‰', svg: `<path d="M200 200 Q 220 180 230 200 Q 220 220 200 200 M230 200 Q 240 180 250 200 Q 240 220 230 200" fill="#A0522D" transform="rotate(-30 225 200)" class="target-animal" />`},
                    { id: 'batta', name: 'ãƒãƒƒã‚¿', hint: 'ãã•ã¨ ãŠãªã˜ ã„ã‚', exp: 'ã€Œãƒãƒƒã‚¿ã€ã¯ ãã•ã‚€ã‚‰ã¨ ãŠãªã˜ ã¿ã©ã‚Šã„ã‚ã€‚ã¦ãã« ã¿ã¤ã‹ã‚Š ã«ãã„ã­ã€‚ï¼ˆã»ã”ã—ã‚‡ãï¼‰', svg: `<path d="M280 250 Q 290 240 300 250 L 295 255 L 300 260 Q 290 250 280 250 M 285 245 L 290 240" fill="#32CD32" stroke="#2E8B57" stroke-width="1" class="target-animal" />`},
                    { id: 'ga', name: 'ã‚¬ (ã›ã„ã¡ã‚…ã†)', hint: 'ãã® ã¿ãã« ã¨ã¾ã£ã¦ã‚‹', exp: 'ã€Œã‚¬ã€ã® ãªã‹ã¾ã¯ã€ãã® ã¿ãã‚„ ã‹ã‚Œã¯ã« ã«ãŸ ã‚‚ã‚ˆã†ã® ã¯ã­ã‚’ ã‚‚ã¤ã‚ˆã€‚ï¼ˆã»ã”ã—ã‚‡ãï¼‰', svg: `<path d="M80 50 L100 60 L80 70 Q 70 60 80 50" fill="#A9A9A9" transform="rotate(90 80 60)" class="target-animal" />`},
                    { id: 'imomushi', name: 'ã‚¤ãƒ¢ãƒ ã‚·', hint: 'ã¯ã£ã±ã¨ ãŠãªã˜ ã„ã‚', exp: 'ã€Œã‚¤ãƒ¢ãƒ ã‚·ã€ã¯ã€ã˜ã¶ã‚“ãŒ ãŸã¹ã‚‹ ã¯ã£ã±ã¨ ãŠãªã˜ ã¿ã©ã‚Šã„ã‚ã€‚ã¨ã‚Šã‹ã‚‰ ã¿ã‚’ ã¾ã‚‚ã‚‹ã‚ˆã€‚ï¼ˆã»ã”ã—ã‚‡ãï¼‰', svg: `<path d="M140 150 Q 145 145 150 150 Q 155 145 160 150 Q 165 145 170 150" fill="none" stroke="#7CFC00" stroke-width="5" class="target-animal" />`},
                ],
                foundCount: 0
            };

            function initFindGame() {
                findGameDoms.svg.innerHTML = findGameData.background;
                findGameDoms.targets.innerHTML = `<h3 class="font-bold text-gray-700">ã•ãŒã—ã¦ã¿ã‚ˆã†:</h3>`; // ãƒªã‚»ãƒƒãƒˆ
                
                findGameData.foundCount = 0;
                const shuffledAnimals = shuffleArray([...findGameData.animals]); // æ¯å›é…ç½®ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«

                shuffledAnimals.forEach(animal => {
                    // 1. ãƒªã‚¹ãƒˆã«è¿½åŠ 
                    const targetItem = document.createElement('div');
                    targetItem.id = `target-${animal.id}`;
                    targetItem.className = 'target-item';
                    targetItem.textContent = `ãƒ» ${animal.hint}`;
                    findGameDoms.targets.appendChild(targetItem);
                    
                    // 2. SVGã«è¿½åŠ 
                    findGameDoms.svg.innerHTML += animal.svg;
                });
                
                // 3. ãŠã‚ã‚‹ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                findGameDoms.targets.appendChild(findGameDoms.quitGameBtn);

                // 4. SVGå†…ã®å‹•ç‰©ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
                findGameDoms.svg.querySelectorAll('.target-animal').forEach((animalEl, index) => {
                    // SVGã«è¿½åŠ ã—ãŸé †ï¼ˆï¼shuffledAnimalsã®é †ï¼‰ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    const animalData = shuffledAnimals[index]; 
                    
                    // animalData.id ã‚’ä½¿ã£ã¦ã€å…ƒã® animals é…åˆ—ã‹ã‚‰æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’å¼•ãå½“ã¦ã‚‹
                    // (ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ã¯ãªãidã§ç…§åˆã™ã‚‹)
                    const correctAnimalData = findGameData.animals.find(a => a.id === animalData.id);

                    if (correctAnimalData) {
                        animalEl.dataset.id = correctAnimalData.id;
                        animalEl.dataset.name = correctAnimalData.name;
                        animalEl.dataset.exp = correctAnimalData.exp;
                        
                        animalEl.addEventListener('click', handleAnimalClick);
                    }
                });
                
                showScreen('findGame');
            }

            function handleAnimalClick(event) {
                const clickedAnimal = event.currentTarget;
                if (clickedAnimal.classList.contains('is-found')) return;

                clickedAnimal.classList.add('is-found');
                findGameData.foundCount++;
                
                const id = clickedAnimal.dataset.id;
                const name = clickedAnimal.dataset.name;
                const exp = clickedAnimal.dataset.exp;
                
                // 1. ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                document.getElementById(`target-${id}`).classList.add('is-found');
                
                // 2. è§£èª¬ã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«ã§è¡¨ç¤º
                explanationText.innerHTML = `<b>${name} ã‚’ ã¿ã¤ã‘ãŸï¼</b><br><br>${exp}`;
                explanationModalOverlay.style.display = 'flex';
                // â˜… è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã¯ã€ŒshowNextExplanationã€ã§ã¯ãªãã€
                //    å˜ç´”ã«é–‰ã˜ã‚‹ã ã‘ã«ã™ã‚‹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯å…±é€šï¼‰
                //    â†’ ã‚³ãƒã‚¯ãƒˆã‚²ãƒ¼ãƒ å´ã§ showNextExplanation ã‚’è¨­å®šã—ã¦ã„ã‚‹ã®ã§
                //      ã“ã“ã§ã¯ä½•ã‚‚ã—ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã€‚

                // 3. å…¨éƒ¨è¦‹ã¤ã‘ãŸã‚‰çµæœè¡¨ç¤º
                if (findGameData.foundCount === findGameData.animals.length) {
                    setTimeout(showFindResult, 800); // è§£èª¬é–‰ã˜ãŸå¾Œãã‚‰ã„
                }
            }
            
            function showFindResult() {
                showScreen('findResult');
                
                // è§£èª¬ã‚¨ãƒªã‚¢ã®ç”Ÿæˆ
                findGameDoms.expArea.innerHTML = '';
                findGameData.animals.forEach(animal => {
                    const expHtml = `
                        <div class="p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                            <b>${animal.name} (${animal.hint})</b><br>
                            <span class="text-sm text-gray-700">${animal.exp}</span>
                        </div>
                    `;
                    findGameDoms.expArea.innerHTML += expHtml;
                });
            }

            // --- ã•ãŒã—ã‚²ãƒ¼ãƒ  ãƒªã‚¹ãƒŠãƒ¼ ---
            findGameDoms.restartBtn.addEventListener('click', initFindGame);
            findGameDoms.backBtn.addEventListener('click', () => {
                showScreen('gameSelect');
            });
            // â˜… ãŠã‚ã‚‹ãƒœã‚¿ãƒ³
            findGameDoms.quitGameBtn.addEventListener('click', () => {
                confirmModalTarget = 'findGame';
                confirmModalOverlay.style.display = 'flex';
                pauseBGM(); // ç¢ºèªä¸­ã¯BGMåœæ­¢
            });

            // --- â˜… è¨­å®šèª­ã¿è¾¼ã¿é–¢æ•° (æ–°è¦è¿½åŠ ) ---
            function loadSettings() {
                // éŸ³é‡è¨­å®š
                const savedVolume = localStorage.getItem(VOLUME_KEY);
                if (savedVolume !== null) {
                    bgm.volume = savedVolume;
                    volumeSlider.value = savedVolume;
                } else {
                    bgm.volume = 0.5; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³é‡
                    volumeSlider.value = 0.5;
                }

                // BGMé¸æŠè¨­å®š
                const savedBGM = localStorage.getItem(BGM_KEY);
                if (savedBGM) {
                    bgmSelect.value = savedBGM;
                    bgm.src = savedBGM;
                } else {
                    bgmSelect.value = 'music.mp3'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆBGM
                    bgm.src = 'music.mp3';
                }
                
                // ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®åˆæœŸçŠ¶æ…‹
                muteToggleBtn.textContent = bgm.muted ? 'BGM ğŸ”‡' : 'BGM ğŸµ';
            }


            // --- åˆæœŸåŒ– ---
            loadSettings(); // â˜… è¨­å®šã‚’èª­ã¿è¾¼ã‚€
            displayRanking(); // èµ·å‹•æ™‚ã«å…¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤º

        });
    </script>
</body>
</html>

